<!doctype html>
<meta charset="utf-8">
<title>Coot Workshop</title>
<meta name="author" content="Paul Bond">
<meta name="description" content="Coot Workshop for the Protein Crystallography Summer School 2019">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" href="css/skeleton.css">
<link rel="stylesheet" href="css/custom.css">

<div class="container">

  <h1>Coot Workshop</h1>
  <h4>Protein Crystallography Summer School 2019</h4>
  <p>
    <a href="https://synergy.st-andrews.ac.uk/proteincrystallography">https://synergy.st-andrews.ac.uk/proteincrystallography</a><br>
    1st to 7th September 2019 (<a href="https://synergy.st-andrews.ac.uk/proteincrystallography/files/2019/05/Timetable-Summer-School-2019-for-Website.pdf">Programme</a>)<br>
    University of York
  </p>

  <ol class="no-print">
    <li><a href="#1">Introduction</a></li>
    <li><a href="#2">Starting</a>
      <ol>
        <li><a href="#2.1">Starting Coot</a></li>
        <li><a href="#2.2">Opening Files</a></li>
      </ol>
    </li>
    <li><a href="#3">Viewing</a>
      <ol>
        <li><a href="#3.1">Controls</a></li>
        <li><a href="#3.2">Virtual Trackball</a></li>
        <li><a href="#3.3">Display Manager</a></li>
        <li><a href="#3.4">Molecule Representations</a></li>
        <li><a href="#3.5">Symmetry & Packing</a></li>
        <li><a href="#3.6">Solvent Boundaries</a></li>
        <li><a href="#3.7">Map Contouring</a></li>
        <li><a href="#3.8">Go To Atom</a></li>
      </ol>
    </li>
    <li><a href="#4">Fixing the protein</a>
      <ol>
        <li><a href="#4.1">Renumber Residue Range</a></li>
        <li><a href="#4.2">Density Fit</a></li>
        <li><a href="#4.3">Deleting</a></li>
        <li><a href="#4.4">Mutating</a></li>
        <li><a href="#4.5">Rotamers</a></li>
        <li><a href="#4.6">Real Space Refinement</a></li>
        <li><a href="#4.7">Adding Terminal Residues</a></li>
      </ol>
    </li>
    <li><a href="#5">Adding solvent</a></li>
    <li><a href="#6">Building a peptide</a></li>
    <li><a href="#7">Adding a ligand</a></li>
  </ol>

  <h3 id="1">1. Introduction</h3>

  <p>
    <i>Coot</i> is a program for macromolecular model building,
    model completion and validation
    (<a href="https://doi.org/10.1107/S0907444910007493">Emsley <i>et al.</i> 2010</a>).
    This workshop will give step-by-step instructions on
    how to use <i>Coot</i> to complete a molecular replacement (MR) solution.
    The structure we are trying to build is
    <a href="https://www.ebi.ac.uk/pdbe/entry/pdb/5eg2">5EG2</a>,
    a human SET7/9 mutant in complex with S-adenosyl-l-homocysteine (SAH) and
    a 10 residue transcription initiation factor
    (<a href="https://doi.org/10.1021/acschembio.5b00852">Fick <i>et al.</i> 2016</a>).
    The data extend to 1.55 &angst; resolution and
    the A chain is small with only 262 residues.
  </p>
  <p>
    As a homology model, we have chosen
    <a href="https://www.ebi.ac.uk/pdbe/entry/pdb/1n6a">1N6A</a>.
    This is an older selenomethionine derivative of human SET7/9
    solved at 1.7 &angst; resolution
    (<a href="https://doi.org/10.1093/emboj/cdg025">Kwon <i>et al.</i> 2003</a>).
    The model was processed using <i>phaser.sculptor</i>,
    which trims unaligned regions using a sequence alignment
    and truncates side chains that differ between the model and target.
    Pruning the MR model was not needed to find a solution in this case
    as it is so similar, but in general it is good practice.
    MR was done using <i>phaser</i>
    through the <i>CCP4i2</i> Basic Molecular Replacement task.
    This was followed by <i>csymmatch</i>
    to move the MR solution to the same origin as the deposited structure
    and finally refinement using <i>REFMAC</i>.
    The following files produced by <i>REFMAC</i> are needed for the workshop:
  </p>
  <ul>
    <li>
      <a href="data/refined_model.mtz">refined_model.mtz</a>
      - reflection data in MTZ format
    </li>
    <li>
      <a href="data/refined_model.pdb">refined_model.pdb</a>
      - coordinates in PDB format
    </li>
  </ul>

  <h3 id="2">2. Starting</h3>

  <h6 id="2.1">2.1. Starting Coot</h6>
  <p>
    Type <code>coot</code> on the command line.
    The <i>Coot</i> window should appear.
    For this to work, the coot executable should be in your path.
    If it is not then you need to source one of the CCP4 setup scripts:
    <pre><code>source ccp4-7.0/bin/ccp4.setup-csh  # if shell is csh/tcsh<br>source ccp4-7.0/bin/ccp4.setup-sh   # if shell is bash</code></pre>
  </p>
  <p>
    The <i>Coot</i> window should look something like this:
  </p>
  <img src="img/window.png" alt="Coot Window">
  <p>
    At the top of the screen is the menu bar with File, Edit, Calculate etc.
    Below this is the main toolbar with a button to open the Display Manager.
    Buttons on the main toolbar can be customised
    by right clicking on the empty space.
    On the right is the refinement toolbar
    with the most widely used model building tools.
    At the bottom of the window is the status bar,
    which is used to display messages.
  </p>

  <h6 id="2.2">2.2. Opening Files</h6>
  <p>
    Files that you want to open in <i>Coot</i>
    can also be passed as command line arguments:
    <pre><code>coot refined_model.pdb refined_mode.mtz</code></pre>
    PDB and mmCIF format coordinate files can be opened in this way,
    as well as MTZ files from programs such as <i>REFMAC</i>
    where the column labels for the 2mFo-DFc and mFo-DFc maps are known.
    Instead, we will open our files manually.
    Choose <code>File / Open Coordinates</code>
    (you can also click the folder icon in the main toolbar).
    A file browser will appear.
    From this you can select a coordinate file,
    as well choose how to recentre the view and the new molecule.
    Select <code>refined_model.pdb</code> and click <code>Open</code>.
  </p>
  <p>
    A window will appear asking you to fix nomenclature errors.
    This is a common occurrence when opening coordinates and is usually because
    there is an atom naming convention for symmetrical residues,
    e.g. which way round CD1 and CD2 are in PHE, that most programs ignore.
    Click <code>Yes</code> to fix them.
  </p>
  <p>
    Now we will open the 2mFo-DFc and mFo-DFc maps.
    Going to <code>File / Auto Open MTZ</code>
    is equivalent to passing the MTZ on the command line
    and will open both maps if it can work out which columns to use.
    We will open the maps one at a time.
    Choose <code>File / Open MTZ, mmCIF, fcf or phs</code>
    to open the file browser.
    Select <code>refined_model.mtz</code> and click <code>Open</code>.
    The following window should appear:
  </p>
  <img src="img/mtz_cols.png" alt="Column Label Assignment">
  <p>
    This window allows you to select
    which amplitude and phase columns to use for the new map.
    Sensible defaults have been chosen for the 2mFo-DFc map.
    In this case there is no need use weights
    because the FWT,PHWT columns are already weighted.
    If you click the <code>Expert Mode?</code> button
    you can also choose resolution limits to truncate the data.
    Click <code>OK</code> to open the 2mFo-DFc map.
  </p>
  <p>
    Now we will open the mFo-DFc map.
    Choose <code>File / Open MTZ, mmCIF, fcf or phs</code> again
    and open <code>refined_model.mtz</code>.
    Change the <code>Amplitudes</code> column to <code>DELFWT</code>
    and the <code>Phases</code> column to <code>PHDELWT</code>.
    The <code>Is a Difference Map</code> checkbox
    needs to be checked (should happen automatically)
    so that <i>Coot</i> will treat this as a difference map.
    Click <code>OK</code>.
  </p>
  <p>
    The maps should be visible as a sphere in the centre of the screen.
    By default, the 2mFo-DFc is coloured blue
    and the mFo-DFc (difference) map is coloured
    green for positive density and red for negative density.
  </p>
  <img src="img/maps.png" alt="2mFo-DFc and mFo-DFc Maps">

  <h3 id="3">3. Viewing</h3>

  <h6 id="3.1">3.1. Controls</h6>
  <p>
    The following controls are used to change the view:
  </p>
  <table>
    <thead>
      <tr><th>Action</th><th>Result</th></tr>
    </thead>
    <tbody>
      <tr><td>Left-mouse drag</td><td>Rotate view</td></tr>
      <tr><td>Ctrl left-mouse drag</td><td>Translate view</td></tr>
      <tr><td>Right-mouse drag</td><td>Zoom</td></tr>
      <tr><td>Ctrl right-mouse drag</td><td>Adjust clipping</td></tr>
      <tr><td>Middle-mouse click</td><td>Centre on atom</td></tr>
    </tbody>
  </table>

  <h6 id="3.2">3.2. Virtual Trackball</h6>
  <p>
    By default, the rotation is done
    using a virtual trackball with a spherical surface.
    It depends not only on the direction you are dragging
    but also where in the view the mouse pointer is.
    If this feels strange you can try changing it
    by going to <code>Edit / Preferences</code>,
    selecting <code>General</code> on the left
    and choosing the <code>HID</code> tab.
    The <code>Flat</code> option will change the rotation
    so that only the direction of dragging matters.
  </p>
  <img src="img/trackball.png" alt="Virtual Trackball">

  <h6 id="3.3">3.3. Display Manager</h6>
  <p>
    Open <code>Display Manager</code> from the main toolbar.
    This shows lists of all the molecules and maps currently open.
    You can toggle whether individual molecules and maps are displayed
    and delete them if they are no longer needed.
    You can also change map properties,
    such as display style and contour levels,
    and molecule representations.
  </p>
  <img src="img/display_manager.png" alt="Display Manager">

  <h6 id="3.4">3.4. Molecule Representations</h6>
  <p>
    The default representation for molecules is
    <code>Bonds (Colour by Atom)</code>,
    which is a good representation for model building.
    However, if we want to look at larger scale features of the model
    the <code>C-alphas/Backbone</code> representation is useful.
    For now, un-display both maps
    and change the molecule representation to <code>Jones' Rainbow</code>.
    This is a variation of the C-alpha representation
    where the chain is coloured
    from blue at the N-terminus to red at the C-terminus.
    The dotted lines at the C-terminus
    show us that there are missing residues there.
  </p>
  <img src="img/rainbow.png" alt="Jones' Rainbow">

  <h6 id="3.5">3.5. Symmetry & Packing</h6>
  <p>
    When checking if a molecular replacement solution is correct,
    it is useful to see whether the packing of molecules
    looks reasonable for a crystal.
    To control the displaying of symmetry equivalents
    go to <code>Draw / Cell & Symmetry</code>.
    The following window should appear:
  </p>
  <img src="img/symmetry.png" alt="Cell & Symmetry">
  <p>
    Turn the <code>Master Switch</code> to <code>Symmetry On</code>
    then click the <code>Symmetry by Molecule</code> button
    to open another window.
    In the new window change the Display Options
    for Molecule 0 (the only molecule)
    to <code>Display as CAs</code> and click <code>OK</code>.
    Increase the <code>Symmetry Atom Display Radius</code>
    to <code>80</code> &angst;,
    change <code>Show Unit Cells?</code> to <code>Yes</code>
    and click <code>OK</code>.
    The spacegroup is P 3<sub>2</sub> 2 1.
    If you rotate the view to look along the C axis of the cell
    you can see the threefold rotation
    and long triangular channels that run through the crystal.
    Also, importantly, the molecule has close contacts with its neighbours
    that are necessary for crystal formation.
    Below, the image on the left shows our correct MR solution
    and the image on the right shows an incorrect MR solution
    without proper crystal packing.
  </p>
  <div class="row">
    <div class="one-half column"><img src="img/packing_good.png" alt="Good Packing"></div>
    <div class="one-half column"><img src="img/packing_bad.png" alt="Bad Packing"></div>
  </div>

  <h6 id="3.6">3.6. Solvent Boundaries</h6>
  <p>
    Another way to tell whether an MR solution is correct
    is by looking at the density.
    Go back to <code>Draw / Cell & Symmetry</code>
    and change <code>Display as CAs</code> to <code>Display Sphere</code>
    in the <code>Symmetry by Molecule</code> window.
    Also reduce <code>Symmetry Atom Display Radius</code>
    to <code>13</code> &angst;,
    change <code>Show Unit Cells?</code> to <code>No</code>
    and click <code>OK</code>.
    In the <code>Display Manager</code>,
    change the molecule representation to <code>Bonds (Colour by Atom)</code>
    and display both maps.
    If you move around the edge of the molecule
    the density should show a clear protein/solvent boundary.
    This won't be the case for a bad MR solution
    as the solvent will have lots of noise.
    The images below show solvent boundaries
    for the correct and incorrect solutions.
  </p>
  <div class="row">
    <div class="one-half column"><img src="img/boundary_good.png" alt="Good Solvent Boundary"></div>
    <div class="one-half column"><img src="img/boundary_bad.png" alt="Bad Solvent Boundary"></div>
  </div>

  <h6 id="3.7">3.7. Map Contouring</h6>
  <p>
    The maps can be contoured at different levels using the mouse scroll wheel
    or <code>+</code> and <code>-</code> on the keyboard.
    Density levels are specified either
    as absolute values (e/&angst;<sup>3</sup>)
    or as RMSD values.
    <i>Coot</i> will try to pick sensible defaults on opening,
    e.g. 0.41 e/&angst;<sup>3</sup> (1.5 RMSD) for our 2mFo-DFc map
    and 0.39 e/&angst;<sub>3</sub> (2.98 RMSD) for our mFo-DFc map.
    One click will change the contour level by 0.1 RMSD.
    Map properties can be edited globally at <code>Edit / Map Parameters</code>
    and for individual maps via the <code>Display Manager</code>.
    It is common to use RMSD when talking about map levels
    but keep in mind that, as the model improves,
    features in the difference map will start to disappear
    so the same level RMSD will display weaker features and more noise.
  </p>

  <h6 id="3.8">3.8. Go To Atom</h6>
  <p>
    A quick way to move about in Coot is to use the Go To Atom window.
    This can be accessed through <code>Draw / Go To Atom</code>,
    pressing <code>F6</code> on the keyboard
    or clicking the <img src="icons/go-to-atom.svg" class="icon"> icon
    in the main toolbar.
  </p>
  <img src="img/go_to_atom.png" alt="Go To Atom">
  <p>
    An atom can be selected using text boxes in the top left
    or the lists at the bottom of the window.
    Clicking <code>Apply</code> will move the view to the selected atom.
    This window can also be used to skip through residues using the
    <code>Next Residue</code> and <code>Previous Residue</code> buttons,
    although it is much quicker to use <code>Space</code> (for next residue)
    and <code>Shift</code><code>Space</code> (for previous residue)
    on the keyboard.
    There is also a quicker method
    of going to a specific residue using the keyboard.
    Press <code>Ctrl</code><code>G</code>
    and a text box should appear at the bottom left of the window.
    Type <code>161</code> and press <code>Enter</code> to go to residue 161.
    If the molecule has multiple chains
    you can prefix the residue number by the chain label.
  </p>

  <h3 id="4">4. Fixing the protein</h3>

  <h6 id="4.1">4.1. Renumber Residue Range</h6>
  <p>
    When preparing the molecular replacement model,
    the residues were numbered so that they start from 1
    at the N-terminus of the crystallised construct
    instead of the N-terminus of the full length protein.
    Residue 161 is actually the mutated N265A
    so we need to renumber the residues to make them match up.
    Go to <code>Edit / Renumber Residues</code>
    to get the following window:
  </p>
  <img src="img/renumber.png" alt="Renumber Residues">
  <p>
    We want to renumber all residues in our chain
    so change the <code>Start Residue</code> to <code>N-terminus</code>
    and the <code>End Residue</code> to <code>C-terminus</code>.
    Residue 161 needs to become 265
    so <code>Apply Offset</code> should be <code>104</code>.
    After clicking <code>Apply</code> you should see the updated atom label.
  </p>

  <h6 id="4.2">4.2. Density Fit Analysis</h6>
  <p>
    This workshop will not go too much into validation
    as it will be covered in other sessions,
    but we will briefly go through density fit analysis
    as it is very useful for getting a quick overview of a model.
    The density fit of a residue is measured using
    the average electron density level at the atom centres.
    Before opening the graphs, go to
    <code>Extensions / Settings / Set Density Fit Graph Weight</code>
    and change the scale value to <code>0.8</code>.
    Then open the analysis window by choosing
    <code>Validate / Density fit analysis</code>
    and picking the molecule.
  </p>
  <img src="img/density_fit.png" alt="Density Fit Analysis">
  <p>
    A window like the one above should appear.
    It shows a graph of residue number against density fit for each chain.
    Residues with good density fit values are small and green,
    and bad density fit values are large and red.
    If all residues are showing as green or red
    then the scaling should be adjusted as we did earlier.
    In this case we can see some residues with poor fit to density,
    mainly at the N and C termini.
    Click on the bar for His116 at the N-terminus to move the view there.
  </p>

  <h6 id="4.3">4.3. Deleting</h6>
  <p>
    Because the density for His116 is not very good
    we may want to delete this residue.
    The delete button can be found at the bottom of the refinement toolbar.
    If you are unsure which buttons correspond to which functions
    you can add text via <code>Edit / Preferences</code>.
    In the <code>Refinement Toolbar</code> tab
    of the <code>General</code> section,
    change the <code>Toolbar Style</code>
    from <code>Icons only</code> to <code>Icons and Text</code>.
    Click the <code>Delete</code> button and the following window should appear:
  </p>
  <img src="img/delete.png" alt="Delete">
  <p>
    Now click on one of the atoms in His116 to delete the residue close.
    Individual atoms (or side chains) can be deleted in
    this way by selecting this option in the window before clicking.
    You can check <code>Keep Delete Active</code> to keep the delete window open
    so that multiple residues can be deleted.
    If the residues are sequential
    it might be easier to use <code>Delete Zone</code>.
    In this case you need to click twice:
    once on the first residue to be deleted and once on the last.
  </p>

  <h6 id="4.4">4.4. Mutating</h6>
  <h6 id="4.5">4.5. Rotamers</h6>
  <h6 id="4.6">4.6. Real Space Refinement</h6>
  <h6 id="4.7">4.7. Adding Terminal Residues</h6>

  <h3 id="5">5. Adding solvent</h3>
  <ol>
    <li>Adding solvent molecules</li>
    <li>Auto find waters</li>
    <li>Checking waters</li>
    <li>Manually add waters</li>
  </ol>

  <h3 id="6">6. Building a peptide</h3>
  <ol>
    <li>Skeleton map</li>
    <li>CA Baton mode</li>
    <li>Mutate residue range</li>
  </ol>

  <h3 id="7">7. Adding a ligand</h3>
  <ol>
    <li>Only if Rob isn't doing this part</li>
  </ol>

  <p>
    Extra?
    Opening Coot via i2? Competition to see who gets the lowest R-free?
    Trying other online tutorials?
  </p>

  <hr>
  <p>
    Paul Bond,
    University of York,
    <a href="mailto:paul.bond@york.ac.uk">paul.bond@york.ac.uk</a>
  </p>
</div>
